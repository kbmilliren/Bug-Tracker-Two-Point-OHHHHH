@model BTProject1.Models.Ticket

@{
    ViewBag.Title = "Details";
}

<h2>Details</h2>

<div>
    <h4>Ticket</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.AssignedUser)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.AssignedUser.Email)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Project)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Project.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Submitter)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Submitter.Email)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Title)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Title)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Description)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Description)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DateCreated)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.DateCreated)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DateUpdated)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.DateUpdated)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Type)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Type.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Priority)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Priority.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Status)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Status.Name)
        </dd>


    </dl>
</div>
<br/>
<div class="btn-group" role="group" aria-label="...">
    <p>
        <button type="button" class="btn btn-default">@Html.ActionLink("Edit", "Edit", new { id = Model.Id }) </button>
        @if (User.IsInRole("Administrator"))
        {
            <button type="button" class="btn btn-default">@Html.ActionLink("Delete", "Delete", new { id = Model.Id }) </button>
        }

        <button type="button" class="btn btn-default">@Html.ActionLink("Back to List", "Index")</button>
    </p>
</div>

<br/>



<div class="row">
    <div class="col-md-6">
        <div class="well">
            <h4>Leave a Comment:</h4>
            <form action="/Tickets/AddComment" method="post">
                <div class="form-group">
                    @Html.Hidden("TicketId", Model.Id)
                    @Html.AntiForgeryToken()
                    <textarea class="form-control" rows="3" name="Comment"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>

        @foreach (var comment in Model.Comments)
        {
            <div class="media">
                <div class="media-body">
                    <h4 class="media-heading">
                        @comment.AssignedUser.UserName
                        <small>@comment.DateCreated.DateTime.ToLongDateString()</small>
                    </h4>
                    @Html.Raw(comment.Comment)
                </div>
            </div>
        }
    </div>
    <div class="col-md-6">
        <div class="well">
            <h4>Add Attachment:</h4>
            <form action="/Tickets/AddAttachment" method="post" enctype="multipart/form-data">
                <div class="form-group col-md-12">
                    @Html.Hidden("TicketId", Model.Id)
                    @Html.AntiForgeryToken()
                    <textarea class="form-control" rows="2" name="Description" style="height:50px;" placeholder="Description"></textarea>
                    <input type="file" name="image" />
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
        @foreach (var attachment in Model.Attachments)
        {
        @attachment.Description
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
        View Attachment
        </button>
        <div class="modal fade" id="myModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Modal title</h4>
                    </div>
                    <div class="modal-body">
                        <img src="@attachment.FileUrl" class="img-responsive" align="middle" />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <br/>
        } 
</div>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2>History</h2>
            @foreach (var history in Model.History)
            {
                <div>
                    Ticket property <span class="blue">@history.Property</span> changed from <span class="red">@history.OldValue</span> to <span class="green">@history.NewValue</span> on @history.DateChanged.DateTime.ToShortDateString() 
                </div>  
            }
        </div>
    </div>
</div>

@section Scripts
{
<script>
    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').focus()
    })
</script>

}
            